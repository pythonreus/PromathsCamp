<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promaths Coding Bootcamp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-blue': '#1a237e',
                        'medium-blue': '#283593',
                        'light-blue': '#303f9f',
                        'accent': '#536dfe',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'slide-in': 'slideIn 0.6s ease-out forwards',
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'bounce-in': 'bounceIn 0.8s ease-out forwards',
                        'pulse-slow': 'pulse 3s infinite',
                        'shake': 'shake 0.5s ease-in-out',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(83, 109, 254, 0.3); }
            to { box-shadow: 0 0 30px rgba(83, 109, 254, 0.6); }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .animate-delay-100 { animation-delay: 100ms; }
        .animate-delay-200 { animation-delay: 200ms; }
        .animate-delay-300 { animation-delay: 300ms; }
        .animate-delay-400 { animation-delay: 400ms; }
        .animate-delay-500 { animation-delay: 500ms; }

        .stagger-animate > * {
            opacity: 0;
            animation: slideIn 0.6s ease-out forwards;
        }

        .hover-lift {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-8px);
        }

        .gradient-text {
            background: linear-gradient(45deg, #536dfe, #303f9f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Star rating styles */
.star-rating i.active {
    color: #ffc107; /* Yellow for active stars */
}

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
        .shape:nth-child(2) { top: 60%; left: 80%; animation-delay: 2s; }
        .shape:nth-child(3) { top: 30%; left: 70%; animation-delay: 4s; }
        .shape:nth-child(4) { top: 80%; left: 10%; animation-delay: 1s; }
        .shape:nth-child(5) { top: 40%; left: 20%; animation-delay: 3s; }

        /* Hide sections by default */
        .user-section { display: none; }
        .guest-section { display: block; }

        /* Tab styles
        .tab-active {
            background-color: rgb(83, 109, 254) !important;
            color: white !important;
        }
        
        .tab-inactive {
            background-color: transparent;
            color: rgb(75, 85, 99);
        } */



        /* Loading states */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #536dfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        /* Tab styles */
        .tab-active {
            background-color: rgb(83, 109, 254) !important;
            color: white !important;
            cursor: pointer;
        }

        .tab-inactive {
            background-color: transparent;
            color: rgb(75, 85, 99);
            cursor: pointer;
        }

        .tab-active:hover {
            background-color: rgb(83, 109, 254) !important;
            color: white !important;
        }

        .tab-inactive:hover {
            background-color: rgb(243, 244, 246);
            color: rgb(75, 85, 99);
        }

        /* Ensure all buttons have pointer cursor */
        button {
            cursor: pointer;
        }

        /* Specific tab button styles */
        .tab-button {
            cursor: pointer;
            user-select: none;
            border: none;
            outline: none;
        }

        /* Temporary debug styles */
        .tab-button:active {
            transform: scale(0.95) !important;
            transition: transform 0.1s !important;
        }

        .tab-button {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .animate-bounce-in {
            pointer-events: none;
        }

    </style>
</head>
<body class="bg-gradient-to-br from-dark-blue to-medium-blue min-h-screen overflow-x-hidden">
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape w-20 h-20 bg-accent rounded-full"></div>
        <div class="shape w-16 h-16 bg-white rounded-lg"></div>
        <div class="shape w-24 h-24 bg-accent rounded-full"></div>
        <div class="shape w-12 h-12 bg-white rounded-lg"></div>
        <div class="shape w-18 h-18 bg-accent rounded-full"></div>
    </div>

    <!-- Header -->
    <header class="bg-dark-blue/95 backdrop-blur-sm sticky top-0 z-50 shadow-lg animate-slide-in">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="text-2xl font-bold text-white animate-pulse-slow">
                    Promaths <span class="text-accent">Coding Bootcamp</span>
                </div>
                <div id="authSection" class="flex items-center space-x-4">
                    <!-- User info when logged in -->
                    <div id="userInfo" class="hidden items-center space-x-3">
                        <img id="userAvatar" class="w-8 h-8 rounded-full" src="" alt="User Avatar">
                        <span id="userName" class="text-white text-sm"></span>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 text-sm">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                    <!-- Login button when not logged in -->
                    <button id="loginBtn" onclick="login()" class="bg-accent hover:bg-light-blue text-white px-6 py-2 rounded-lg transition-all duration-200 transform hover:scale-105">
                        <i class="fab fa-google mr-2"></i>Login with Google
                    </button>
                </div>
            </div>
        </div>

        

    </header>

    <!-- Guest Section (Visible when not logged in) -->
    <div id="guestSection" class="guest-section">
        <!-- Hero Section -->
        <section class="bg-gradient-to-r from-medium-blue/90 to-dark-blue/90 py-20 relative overflow-hidden">
            <div class="container mx-auto px-4 text-center relative z-10">
                <div class="opacity-0 animate-bounce-in">
                    <h1 class="text-5xl md:text-6xl font-bold text-white mb-6 gradient-text">
                        CO·CO·CODE
                    </h1>
                </div>
                <p class="text-xl text-blue-100 max-w-2xl mx-auto opacity-0 animate-fade-in animate-delay-500">
                    Join our intensive coding bootcamp and transform your future. Learn in-demand skills and stay ahead.
                </p>
                <div class="mt-8 opacity-0 animate-fade-in animate-delay-700">
                    <button onclick="login()" class="bg-accent hover:bg-light-blue text-white font-semibold py-4 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 animate-pulse-slow">
                        <i class="fab fa-google mr-2"></i>Login to Access Resources
                    </button>
                </div>
            </div>
        </section>

        <!-- Program Details Section -->
        <section class="py-16 bg-white relative">
            <div class="container mx-auto px-4 max-w-6xl">
                <h2 class="text-4xl font-bold text-center text-dark-blue mb-12 opacity-0 animate-slide-in">
                    Program Details
                </h2>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 stagger-animate">
                    <!-- Detail Cards -->
                    <div class="bg-gray-50 p-8 rounded-xl shadow-lg hover-lift border-l-4 border-accent animate-delay-100">
                        <div class="w-12 h-12 bg-accent rounded-lg flex items-center justify-center mb-4 animate-glow">
                            <i class="fas fa-book text-white text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-dark-blue mb-3">Comprehensive Curriculum</h3>
                        <p class="text-gray-600">Learn full-stack development with modern technologies including JavaScript, Node.js, and databases.</p>
                    </div>

                    <div class="bg-gray-50 p-8 rounded-xl shadow-lg hover-lift border-l-4 border-green-500 animate-delay-200">
                        <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-users text-white text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-dark-blue mb-3">Target Audience</h3>
                        <p class="text-gray-600">This is for anyone who wants to learn how to build a full working web app, no prior coding required</p>
                    </div>

                    <div class="bg-gray-50 p-8 rounded-xl shadow-lg hover-lift border-l-4 border-purple-500 animate-delay-300">
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-bullseye text-white text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-dark-blue mb-3">Objective</h3>
                        <p class="text-gray-600">the main goal is to equip everyone with skills to survive the tech world but most importantly, lets say something is coming next year :)</p>
                    </div>

                    <div class="bg-gray-50 p-8 rounded-xl shadow-lg hover-lift border-l-4 border-orange-500 animate-delay-400">
                        <div class="w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-hands text-white text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-dark-blue mb-3">Hands-on Projects</h3>
                        <p class="text-gray-600">Build projects that showcase your skills and enhance your portfolio.</p>
                    </div>

                    <div class="bg-gray-50 p-8 rounded-xl shadow-lg hover-lift border-l-4 border-pink-500 animate-delay-500">
                        <div class="w-12 h-12 bg-pink-500 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-heart text-white text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-dark-blue mb-3">Community Learning</h3>
                        <p class="text-gray-600">Join a supportive promaths community of students and collaborate on projects together.</p>
                    </div>

                    <div class="bg-gray-50 p-8 rounded-xl shadow-lg hover-lift border-l-4 border-teal-500 animate-delay-600">
                        <div class="w-12 h-12 bg-teal-500 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-calendar-alt text-white text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-dark-blue mb-3">Flexible Schedule</h3>
                        <p class="text-gray-600">Online lessons with flexible timing to accommodate your current commitments. Sessions are based availability</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

   

    <!-- User Dashboard Section (Visible when logged in) -->
    <div id="userSection" class="user-section">
        <!-- Welcome Section -->
        <section class="bg-gradient-to-r from-medium-blue/90 to-dark-blue/90 py-16 relative overflow-hidden ">
            <div class="container mx-auto px-4 text-center relative z-10">
                <div class="opacity-0 animate-bounce-in pointer-events-none">
                    <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
                        Welcome, <span id="welcomeName" class="gradient-text"></span>!
                    </h1>
                    <p class="text-xl text-blue-100 max-w-2xl mx-auto">
                        Ready to continue your coding journey?
                    </p>
                </div>
            </div>
        </section>

         <!-- Navigation Tabs -->
        <section class="bg-white py-8 border-b relative z-20 ">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 bg-gray-100 rounded-lg p-1 max-w-md mx-auto">
                    <button  id="resourcesTab" class="tab-button flex-1 py-3 px-6 rounded-md font-semibold transition-all duration-200 tab-active">
                        <i class="fas fa-link mr-2"></i>Resources
                    </button>
                    <button id="lessonsTab" class="tab-button flex-1 py-3 px-6 rounded-md font-semibold transition-all duration-200 tab-inactive">
                        <i class="fas fa-book mr-2"></i>Lessons
                    </button>
                    <!-- Add this to your navigation tabs section (after lessons tab) -->
                    <button id="surveyTab" class="tab-button flex-1 py-3 px-6 rounded-md font-semibold transition-all duration-200 tab-inactive">
                        <i class="fas fa-poll mr-2"></i>Survey
                    </button>
                </div>
            </div>
        </section>

       
        <!-- Resources Section -->
        <section id="resourcesSection" class="py-16 bg-gray-50" >
            <div class="w-full px-4 mx-auto max-w-screen-2xl">

                <h2 class="text-3xl font-bold text-center text-dark-blue mb-12">
                    <i class="fas fa-link text-accent mr-3"></i>Learning Resources
                </h2>
                
                <!-- Resources Loading State -->
                <div id="resourcesLoading" class="text-center py-12">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading resources...</p>
                </div>

                <!-- Resources Empty State -->
                <div id="resourcesEmpty" class="hidden text-center py-12">
                    <i class="fas fa-link text-gray-400 text-6xl mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No Resources Available</h3>
                    <p class="text-gray-500">Check back later for learning resources.</p>
                </div>

                <!-- Resources Grid -->
                <div id="resourcesGrid" class="flex flex-col items-center space-y-8 hidden"></div>

                    <!-- Resources will be populated here dynamically -->
            </div>
        </section>

        <!-- Lessons Section -->
        <section id="lessonsSection" class="py-16 bg-white hidden">
            <div class="container mx-auto px-4 max-w-6xl">
                <h2 class="text-3xl font-bold text-center text-dark-blue mb-12">
                    <i class="fas fa-book text-accent mr-3"></i>Daily Lessons
                </h2>

                <!-- Lessons Loading State -->
                <div id="lessonsLoading" class="text-center py-12">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading lessons...</p>
                </div>

                <!-- Lessons Empty State -->
                <div id="lessonsEmpty" class="hidden text-center py-12">
                    <i class="fas fa-book text-gray-400 text-6xl mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No Lessons Available</h3>
                    <p class="text-gray-500">Check back later for new lessons.</p>
                </div>

                <!-- Lessons Container -->
                <div id="lessonsContainer" class="space-y-8 hidden">
                    <!-- Lessons will be populated here dynamically -->
                </div>
            </div>
        </section>

        <!-- Survey Section -->
<section id="surveySection" class="py-16 bg-gray-50 hidden">
    <div class="container mx-auto px-4 max-w-4xl">
        <h2 class="text-3xl font-bold text-center text-dark-blue mb-12">
            <i class="fas fa-poll text-accent mr-3"></i>Program Feedback Survey
        </h2>

        <!-- Already Submitted Message -->
        <div id="alreadySubmitted" class="hidden">
            <div class="bg-green-50 border border-green-200 rounded-xl p-8 text-center mb-8">
                <i class="fas fa-check-circle text-green-500 text-5xl mb-4"></i>
                <h3 class="text-2xl font-bold text-green-800 mb-2">Thank You!</h3>
                <p class="text-green-700 mb-4">You have already submitted your feedback. We appreciate your input!</p>
                <div class="bg-green-100 p-4 rounded-lg inline-block">
                    <p class="text-green-800 font-medium">You submitted your survey on <span id="submissionDate"></span></p>
                </div>
            </div>
        </div>

        <!-- Survey Form -->
        <div id="surveyFormContainer" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <p class="text-gray-600 mb-6 text-center">
                    Please take a few minutes to share your experience with the Promaths Coding Bootcamp. 
                    Your feedback helps us improve the program for future students.
                </p>

                <form id="surveyForm" class="space-y-8">
                    <!-- Question 1: Learned Anything -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            1. Have you learned anything so far? *
                        </label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="learnedAnything" value="Yes" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">Yes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="learnedAnything" value="No" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">No</span>
                            </label>
                        </div>
                    </div>

                    <!-- Question 2: Results Observed -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            2. Are you seeing results in this program? *
                        </label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="resultsObserved" value="Big results" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">Big results</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="resultsObserved" value="Small results" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">Small results</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="resultsObserved" value="No results" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">No results</span>
                            </label>
                        </div>
                    </div>

                    <!-- Question 3: Continue Next Year -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            3. Would you like to see this program continue to the next year? *
                        </label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="continueNextYear" value="Yes" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">Yes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="continueNextYear" value="No" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">No</span>
                            </label>
                        </div>
                    </div>

                    <!-- Question 4: Challenges Faced -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            4. What challenges have you faced? *
                        </label>
                        <textarea name="challengesFaced" required rows="4"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent resize-none"
                            placeholder="Please describe any challenges you've encountered during the program..."></textarea>
                        <p class="text-sm text-gray-500 mt-2">Please be specific about any technical, time management, or learning challenges.</p>
                    </div>

                    <!-- Question 5: Improvements -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            5. What can we do to improve as the program? *
                        </label>
                        <textarea name="improvementsSuggested" required rows="4"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent resize-none"
                            placeholder="Your suggestions for program improvement..."></textarea>
                        <p class="text-sm text-gray-500 mt-2">What changes would make the program better for future students?</p>
                    </div>

                    <!-- Question 6: Help Needed -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            6. How would you like us to help you improve? *
                        </label>
                        <textarea name="helpNeeded" required rows="4"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent resize-none"
                            placeholder="What additional support would help you succeed..."></textarea>
                        <p class="text-sm text-gray-500 mt-2">Please specify any areas where you need more support or guidance.</p>
                    </div>

                    <!-- Question 7: Exercises Helpfulness -->
                    <div class="border-b pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            7. Are the exercises helpful? *
                        </label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="exercisesHelpfulness" value="Very helpful" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">Very helpful</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="exercisesHelpfulness" value="To some extent" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">To some extent</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="exercisesHelpfulness" value="Not really" required 
                                    class="mr-3 h-5 w-5 text-accent focus:ring-accent">
                                <span class="text-gray-700">Not really</span>
                            </label>
                        </div>
                    </div>

                    <!-- Question 8: Experience Rating -->
                    <div class="pb-6">
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            8. How would you rate your experience out of 10 so far? *
                        </label>
                        <div class="mb-6">
                            <input type="range" name="experienceRating" min="1" max="10" value="5" required 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-accent"
                                oninput="updateRatingValue(this.value)">
                            <div class="flex justify-between mt-2">
                                <span class="text-sm text-gray-500">1 - Poor</span>
                                <div class="text-center">
                                    <span id="ratingValue" class="text-2xl font-bold text-accent">5</span>
                                    <span class="text-gray-600">/10</span>
                                </div>
                                <span class="text-sm text-gray-500">10 - Excellent</span>
                            </div>
                        </div>
                        
                        <!-- Star Rating Visual -->
                        <!-- Star Rating Visual -->
                    <div class="flex justify-center mb-2" id="starRating">
                        ${Array(10).fill().map((_, i) => `
                            <i class="fas fa-star text-gray-300 text-xl mx-0.5 star-${i+1}"></i>
                        `).join('')}
                    </div>
                    </div>

                    <!-- Additional Comments -->
                    <div>
                        <label class="block text-lg font-semibold text-dark-blue mb-4">
                            Additional Comments (Optional)
                        </label>
                        <textarea name="additionalComments" rows="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent resize-none"
                            placeholder="Any other feedback or comments..."></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-6 border-t">
                        <button type="submit" id="submitSurveyBtn" 
                            class="w-full bg-accent hover:bg-light-blue text-white font-bold py-4 px-6 rounded-lg transition-all duration-300 transform hover:scale-[1.02] focus:scale-[1.02]">
                            <i class="fas fa-paper-plane mr-2"></i>Submit Survey
                        </button>
                        <p class="text-sm text-gray-500 text-center mt-4">
                            * Required fields. You can only submit this survey once.
                        </p>
                    </div>
                </form>
            </div>
        </div>

        <!-- Survey Loading State -->
        <div id="surveyLoading" class="text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Loading survey...</p>
        </div>
    </div>
</section>
    </div>

    <!-- Footer -->
    <footer class="bg-dark-blue text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="flex items-center justify-center gap-2">
                <i class="fas fa-heart text-red-400 animate-pulse"></i>
                Created by Kgadi Selepe | 2025 Promaths Coding Bootcamp. All rights reserved.
            </p>   
        </div>
    </footer>

    <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCiGkxTPBZGcnoLjYxmGIQgcoAIeKTlhlk",
        authDomain: "promathsbootcamp.firebaseapp.com",
        projectId: "promathsbootcamp",
        storageBucket: "promathsbootcamp.firebasestorage.app",
        messagingSenderId: "824154890090",
        appId: "1:824154890090:web:253e7f9e53ec698d214f13",
        measurementId: "G-CN437086VR"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Global variables
    let currentUser = null;
    let resources = [];
    let lessons = [];
    let userSubmissions = [];
    let userHasSubmittedSurvey = false;
    let existingSurvey = null;

    // Auth state observer
    firebase.auth().onAuthStateChanged(async (user) => {
        if (user) {
            currentUser = user;

            // Call your new endpoint to verify/sync with your database
            const response = await fetch('/api/auth/verify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    firebaseUid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL
                })
            });
            
            const result = await response.json();
            if (result.success) {
                showUserSection(user);
                loadResources();
                loadLessons();
            } else {
                currentUser = null;
                showGuestSection();
            }
        } else {
            currentUser = null;
            userSubmissions = []; // Clear submissions when user logs out
            showGuestSection();
        }
    });

    // Authentication functions
    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider)
            .then((result) => {
                console.log('User logged in:', result.user);
            })
            .catch((error) => {
                console.error('Login error:', error);
                showNotification('Login failed. Please try again.', 'error');
            });
    }

    function logout() {
        firebase.auth().signOut()
            .then(() => {
                console.log('User logged out');
                showNotification('Logged out successfully', 'success');
            })
            .catch((error) => {
                console.error('Logout error:', error);
                showNotification('Logout failed', 'error');
            });
    }

    // Section management
    function showUserSection(user) {
        document.getElementById('guestSection').style.display = 'none';
        document.getElementById('userSection').style.display = 'block';
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('userInfo').style.display = 'flex';
        
        // Update user info
        document.getElementById('userAvatar').src = user.photoURL;
        document.getElementById('userName').textContent = user.displayName;
        document.getElementById('welcomeName').textContent = user.displayName;
        
        // Set initial section states
        document.getElementById('resourcesSection').classList.remove('hidden');
        document.getElementById('lessonsSection').classList.add('hidden');
        document.getElementById('surveySection').classList.add('hidden');
        
        // Set initial tab states
        document.getElementById('resourcesTab').classList.add('tab-active');
        document.getElementById('resourcesTab').classList.remove('tab-inactive');
        document.getElementById('lessonsTab').classList.add('tab-inactive');
        document.getElementById('lessonsTab').classList.remove('tab-active');
        document.getElementById('surveyTab').classList.add('tab-inactive');
        document.getElementById('surveyTab').classList.remove('tab-active');
        
        // Initialize tab event listeners
        initializeTabs();
        
        // Load data
        loadResources();
        loadLessons();
    }

    function showGuestSection() {
        document.getElementById('guestSection').style.display = 'block';
        document.getElementById('userSection').style.display = 'none';
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('userInfo').style.display = 'none';
    }

    // Tab Navigation
    function showSection(sectionName) {
        console.log('Switching to section:', sectionName);
        
        // Hide all sections
        document.getElementById('resourcesSection').classList.add('hidden');
        document.getElementById('lessonsSection').classList.add('hidden');
        document.getElementById('surveySection').classList.add('hidden');
        
        // Remove active state from all tabs
        document.getElementById('resourcesTab').classList.remove('tab-active');
        document.getElementById('resourcesTab').classList.add('tab-inactive');
        document.getElementById('lessonsTab').classList.remove('tab-active');
        document.getElementById('lessonsTab').classList.add('tab-inactive');
        document.getElementById('surveyTab').classList.remove('tab-active');
        document.getElementById('surveyTab').classList.add('tab-inactive');
        
        // Show selected section and activate tab
        if (sectionName === 'resources') {
            document.getElementById('resourcesSection').classList.remove('hidden');
            document.getElementById('resourcesTab').classList.remove('tab-inactive');
            document.getElementById('resourcesTab').classList.add('tab-active');
            console.log('Resources section shown');
        } else if (sectionName === 'lessons') {
            document.getElementById('lessonsSection').classList.remove('hidden');
            document.getElementById('lessonsTab').classList.remove('tab-inactive');
            document.getElementById('lessonsTab').classList.add('tab-active');
            console.log('Lessons section shown');
        } else if (sectionName === 'survey') {
            document.getElementById('surveySection').classList.remove('hidden');
            document.getElementById('surveyTab').classList.remove('tab-inactive');
            document.getElementById('surveyTab').classList.add('tab-active');
            console.log('Survey section shown');
            loadSurveyStatus(); // Check if user has already submitted
        }
    }

    function initializeTabs() {
        const resourcesTab = document.getElementById('resourcesTab');
        const lessonsTab = document.getElementById('lessonsTab');
        const surveyTab = document.getElementById('surveyTab');
        
        // Clear any existing listeners
        resourcesTab.replaceWith(resourcesTab.cloneNode(true));
        lessonsTab.replaceWith(lessonsTab.cloneNode(true));
        surveyTab.replaceWith(surveyTab.cloneNode(true));
        
        // Get fresh references
        const freshResourcesTab = document.getElementById('resourcesTab');
        const freshLessonsTab = document.getElementById('lessonsTab');
        const freshSurveyTab = document.getElementById('surveyTab');
        
        freshResourcesTab.addEventListener('click', () => showSection('resources'));
        freshLessonsTab.addEventListener('click', () => showSection('lessons'));
        freshSurveyTab.addEventListener('click', () => showSection('survey'));
        
        console.log('Tabs initialized successfully');
    }

    // Resources Management
    async function loadResources() {
        try {
            showResourcesLoading();
            
            const response = await fetch('/api/resources');
            const result = await response.json();
            
            if (result.success) {
                resources = result.data;
                displayResources();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Error loading resources:', error);
            showResourcesEmpty();
            showNotification('Failed to load resources', 'error');
        }
    }

    function displayResources() {
        const resourcesGrid = document.getElementById('resourcesGrid');
        const loadingState = document.getElementById('resourcesLoading');
        const emptyState = document.getElementById('resourcesEmpty');

        loadingState.classList.add('hidden');

        if (resources.length === 0) {
            emptyState.classList.remove('hidden');
            resourcesGrid.classList.add('hidden');
            return;
        }

        emptyState.classList.add('hidden');
        resourcesGrid.classList.remove('hidden');

        // Define color arrays
        const borderColors = [
            'border-l-4 border-accent',
            'border-l-4 border-green-500',
            'border-l-4 border-purple-500',
            'border-l-4 border-orange-500',
            'border-l-4 border-pink-500',
            'border-l-4 border-teal-500'
        ];
        
        const iconColors = [
            'bg-accent',
            'bg-green-500',
            'bg-purple-500',
            'bg-orange-500',
            'bg-pink-500',
            'bg-teal-500'
        ];
        
        const linkColors = [
            'text-accent hover:text-accent',
            'text-green-600 hover:text-green-700',
            'text-purple-600 hover:text-purple-700',
            'text-orange-600 hover:text-orange-700',
            'text-pink-600 hover:text-pink-700',
            'text-teal-600 hover:text-teal-700'
        ];

        // Create resource cards with different colors
        resourcesGrid.innerHTML = resources.map((resource, index) => {
            const colorIndex = index % borderColors.length;
            const borderColor = borderColors[colorIndex];
            const iconColor = iconColors[colorIndex];
            const linkColor = linkColors[colorIndex];
            
            return `
                <div class="bg-white p-6 w-full max-w-3xl rounded-xl shadow-lg hover-lift ${borderColor} transition-all duration-300">
                    <div class="w-12 h-12 ${iconColor} rounded-lg flex items-center justify-center mb-4">
                        <i class="fas fa-link text-white text-lg"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-dark-blue mb-3">${escapeHtml(resource.title)}</h3>
                    <p class="text-gray-600 mb-4">${escapeHtml(resource.description)}</p>
                    <a href="${resource.link}" target="_blank" 
                    class="inline-flex items-center ${linkColor} font-semibold hover:underline transition-colors duration-200">
                        Visit Resource <i class="fas fa-external-link-alt ml-2"></i>
                    </a>
                    <p class="text-sm text-gray-500 mt-3">Added: ${new Date(resource.createdAt).toLocaleDateString()}</p>
                </div>
            `;
        }).join('');
    }

    function showResourcesLoading() {
        document.getElementById('resourcesLoading').classList.remove('hidden');
        document.getElementById('resourcesEmpty').classList.add('hidden');
        document.getElementById('resourcesGrid').classList.add('hidden');
    }

    function showResourcesEmpty() {
        document.getElementById('resourcesLoading').classList.add('hidden');
        document.getElementById('resourcesEmpty').classList.remove('hidden');
        document.getElementById('resourcesGrid').classList.add('hidden');
    }

    // Lessons Management
    async function loadLessons() {
        try {
            showLessonsLoading();
            
            // Fetch lessons
            const lessonsResponse = await fetch('/api/lessons');
            const lessonsResult = await lessonsResponse.json();
            
            if (lessonsResult.success) {
                lessons = lessonsResult.data.filter(lesson => lesson.isActive);
                
                // Fetch user's submissions if logged in
                if (currentUser) {
                    await loadUserSubmissions();
                }
                
                displayLessons();
            } else {
                throw new Error(lessonsResult.message);
            }
        } catch (error) {
            console.error('Error loading lessons:', error);
            showLessonsEmpty();
            showNotification('Failed to load lessons', 'error');
        }
    }

    async function loadUserSubmissions() {
        try {
            const response = await fetch('/api/submissions');
            const result = await response.json();
            
            if (result.success) {
                userSubmissions = result.data.filter(submission => 
                    submission.studentEmail === currentUser.email
                );
            }
        } catch (error) {
            console.error('Error loading submissions:', error);
        }
    }

    function displayLessons() {
        const lessonsContainer = document.getElementById('lessonsContainer');
        const loadingState = document.getElementById('lessonsLoading');
        const emptyState = document.getElementById('lessonsEmpty');

        loadingState.classList.add('hidden');

        if (lessons.length === 0) {
            emptyState.classList.remove('hidden');
            lessonsContainer.classList.add('hidden');
            return;
        }

        emptyState.classList.add('hidden');
        lessonsContainer.classList.remove('hidden');
        lessonsContainer.innerHTML = '';

        lessons.forEach((lesson, index) => {
            const userSubmission = userSubmissions.find(sub => 
                sub.lessonId && (sub.lessonId._id === lesson._id || sub.lessonId === lesson._id)
            );
            
            const lessonDiv = document.createElement('div');
            lessonDiv.className = 'bg-gray-50 rounded-xl shadow-lg p-8 border-l-4 border-accent hover-lift transition-all duration-300 mb-8';
            
            const escapedTitle = escapeHtml(lesson.title || 'Untitled Lesson');
            const escapedProjectTitle = escapeHtml(lesson.projectTitle || 'No project title');
            
            lessonDiv.innerHTML = `
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-dark-blue mb-2">${escapedTitle}</h3>
                        <p class="text-gray-600">Published: ${new Date(lesson.createdAt).toLocaleDateString()}</p>
                        ${lesson.dueDate ? `
                            <p class="text-gray-600 mt-1">
                                <i class="fas fa-calendar-alt mr-2"></i>
                                Due: ${new Date(lesson.dueDate).toLocaleDateString()}
                            </p>
                        ` : ''}
                    </div>
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold mt-2 md:mt-0">
                        Active
                    </span>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-dark-blue mb-3 flex items-center">
                        <i class="fas fa-sticky-note text-accent mr-2"></i>Lesson Notes
                    </h4>
                    <div class="bg-white p-4 rounded-lg border">
                        <div class="text-gray-700 whitespace-pre-wrap" id="content-${lesson._id}"></div>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-dark-blue mb-3 flex items-center">
                        <i class="fas fa-tasks text-accent mr-2"></i>Project: ${escapedProjectTitle}
                    </h4>
                    <div class="bg-white p-4 rounded-lg border">
                        <div class="text-gray-700 whitespace-pre-wrap" id="instructions-${lesson._id}"></div>
                    </div>
                </div>

                <div id="submission-${lesson._id}"></div>
            `;
            
            const contentDiv = lessonDiv.querySelector(`#content-${lesson._id}`);
            const instructionsDiv = lessonDiv.querySelector(`#instructions-${lesson._id}`);
            const submissionDiv = lessonDiv.querySelector(`#submission-${lesson._id}`);
            
            if (contentDiv) contentDiv.textContent = lesson.content || 'No content available';
            if (instructionsDiv) instructionsDiv.textContent = lesson.projectInstructions || 'No instructions available';
            if (submissionDiv) submissionDiv.innerHTML = renderSubmissionSection(lesson, userSubmission);
            
            lessonsContainer.appendChild(lessonDiv);
        });
    }

    function renderSubmissionSection(lesson, submission) {
        if (!currentUser) {
            return `
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                    <p class="text-yellow-700">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        You must be logged in to submit a project
                    </p>
                </div>
            `;
        }
        
        if (submission) {
            const status = submission.status || 'submitted';
            const statusColors = {
                'submitted': 'bg-blue-100 text-blue-800',
                'reviewed': 'bg-yellow-100 text-yellow-800',
                'approved': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800'
            };
            
            const statusText = {
                'submitted': 'Submitted - Pending Review',
                'reviewed': 'Under Review',
                'approved': 'Approved ✓',
                'rejected': 'Needs Revision'
            };
            
            return `
                <div>
                    <h4 class="text-lg font-semibold text-dark-blue mb-3 flex items-center">
                        <i class="fas fa-paper-plane text-accent mr-2"></i>Your Submission Status
                    </h4>
                    <div class="bg-white p-6 rounded-lg border">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                            <div>
                                <h5 class="font-semibold text-gray-700">Project Link:</h5>
                                <a href="${submission.projectLink}" target="_blank" 
                                class="text-accent hover:underline break-all">
                                    ${submission.projectLink}
                                </a>
                                <p class="text-sm text-gray-500 mt-1">
                                    Submitted: ${new Date(submission.submittedAt).toLocaleString()}
                                </p>
                            </div>
                            <span class="inline-flex px-3 py-1 rounded-full text-sm font-semibold mt-2 sm:mt-0 ${statusColors[status]}">
                                ${statusText[status]}
                            </span>
                        </div>
                        
                        ${status === 'rejected' ? `
                            <div class="mt-4 pt-4 border-t">
                                <p class="text-red-600 mb-3">
                                    <i class="fas fa-exclamation-circle mr-2"></i>
                                    Please revise your project and resubmit.
                                </p>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <input type="url" 
                                        id="resubmitLink-${lesson._id}"
                                        placeholder="https://github.com/your-username/updated-project" 
                                        class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                                    <button onclick="resubmitProject('${lesson._id}', '${submission._id}')" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-all duration-200 font-semibold">
                                        Resubmit
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="mt-4">
                            <button onclick="showUpdateForm('${lesson._id}', '${submission.projectLink}')" 
                                class="text-accent hover:text-light-blue font-medium text-sm">
                                <i class="fas fa-edit mr-1"></i>Update your submission
                            </button>
                        </div>
                    </div>
                </div>
            `;
        } else {
            return `
                <div>
                    <h4 class="text-lg font-semibold text-dark-blue mb-3 flex items-center">
                        <i class="fas fa-paper-plane text-accent mr-2"></i>Submit Your Project
                    </h4>
                    <div class="bg-white p-4 rounded-lg border">
                        <p class="text-gray-600 mb-3">Paste the link to your GitHub repository or live demo:</p>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <input type="url" 
                                id="projectLink-${lesson._id}"
                                placeholder="https://github.com/your-username/project" 
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                            <button onclick="submitProject('${lesson._id}')" 
                                class="bg-accent hover:bg-light-blue text-white px-6 py-2 rounded-lg transition-all duration-200 font-semibold">
                                Submit Project
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Make sure your repository is public so we can review your code.</p>
                    </div>
                </div>
            `;
        }
    }

    function showLessonsLoading() {
        document.getElementById('lessonsLoading').classList.remove('hidden');
        document.getElementById('lessonsEmpty').classList.add('hidden');
        document.getElementById('lessonsContainer').classList.add('hidden');
    }

    function showLessonsEmpty() {
        document.getElementById('lessonsLoading').classList.add('hidden');
        document.getElementById('lessonsEmpty').classList.remove('hidden');
        document.getElementById('lessonsContainer').classList.add('hidden');
    }

    // Project Submission Functions
    async function submitProject(lessonId) {
        const projectLink = document.getElementById(`projectLink-${lessonId}`).value.trim();
        
        if (!projectLink) {
            showNotification('Please enter a project link', 'error');
            return;
        }

        if (!currentUser) {
            showNotification('You must be logged in to submit a project', 'error');
            return;
        }

        try {
            const submissionData = {
                studentName: currentUser.displayName,
                studentEmail: currentUser.email,
                lessonId: lessonId,
                projectLink: projectLink
            };

            const response = await fetch('/api/submissions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(submissionData)
            });

            const result = await response.json();

            if (result.success) {
                showNotification('Project submitted successfully!', 'success');
                document.getElementById(`projectLink-${lessonId}`).value = '';
                await loadLessons();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Error submitting project:', error);
            showNotification('Failed to submit project: ' + error.message, 'error');
        }
    }

    async function resubmitProject(lessonId, submissionId) {
        const projectLink = document.getElementById(`resubmitLink-${lessonId}`).value.trim();
        
        if (!projectLink) {
            showNotification('Please enter a project link', 'error');
            return;
        }

        try {
            const submissionData = {
                studentName: currentUser.displayName,
                studentEmail: currentUser.email,
                lessonId: lessonId,
                projectLink: projectLink
            };

            const response = await fetch('/api/submissions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(submissionData)
            });

            const result = await response.json();

            if (result.success) {
                showNotification('Project resubmitted successfully!', 'success');
                await loadLessons();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Error resubmitting project:', error);
            showNotification('Failed to resubmit project: ' + error.message, 'error');
        }
    }

    function showUpdateForm(lessonId, currentLink) {
        const formHtml = `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold text-dark-blue mb-4">Update Your Submission</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">New Project Link</label>
                        <input type="url" 
                            id="updateLink-${lessonId}"
                            value="${currentLink}"
                            placeholder="https://github.com/your-username/project" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                    </div>
                    <div class="flex justify-end gap-3">
                        <button onclick="closeUpdateForm()" 
                            class="px-4 py-2 text-gray-600 hover:text-gray-800">
                            Cancel
                        </button>
                        <button onclick="updateProject('${lessonId}')" 
                            class="bg-accent hover:bg-light-blue text-white px-6 py-2 rounded-lg font-semibold">
                            Update
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        const existingModal = document.getElementById('updateModal');
        if (existingModal) existingModal.remove();
        
        const modal = document.createElement('div');
        modal.id = 'updateModal';
        modal.innerHTML = formHtml;
        document.body.appendChild(modal);
    }

    function closeUpdateForm() {
        const modal = document.getElementById('updateModal');
        if (modal) modal.remove();
    }

    async function updateProject(lessonId) {
        const projectLink = document.getElementById(`updateLink-${lessonId}`).value.trim();
        
        if (!projectLink) {
            showNotification('Please enter a project link', 'error');
            return;
        }

        try {
            const submissionData = {
                studentName: currentUser.displayName,
                studentEmail: currentUser.email,
                lessonId: lessonId,
                projectLink: projectLink
            };

            const response = await fetch('/api/submissions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(submissionData)
            });

            const result = await response.json();

            if (result.success) {
                showNotification('Project updated successfully!', 'success');
                closeUpdateForm();
                await loadLessons();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Error updating project:', error);
            showNotification('Failed to update project: ' + error.message, 'error');
        }
    }

    // Survey Functions
    async function loadSurveyStatus() {
        try {
            document.getElementById('surveyLoading').classList.remove('hidden');
            document.getElementById('alreadySubmitted').classList.add('hidden');
            document.getElementById('surveyFormContainer').classList.add('hidden');
            
            if (!currentUser) {
                showNotification('Please login to access the survey', 'error');
                return;
            }
            
            // Check if user has already submitted
            const response = await fetch(`/api/surveys?studentEmail=${encodeURIComponent(currentUser.email)}`);
            const result = await response.json();
            
            document.getElementById('surveyLoading').classList.add('hidden');
            
            if (result.success && result.data && result.data.length > 0) {
                userHasSubmittedSurvey = true;
                existingSurvey = result.data[0];
                
                document.getElementById('alreadySubmitted').classList.remove('hidden');
                document.getElementById('submissionDate').textContent = 
                    new Date(existingSurvey.submissionDate).toLocaleDateString();
                
                document.getElementById('surveyFormContainer').classList.add('hidden');
            } else {
                userHasSubmittedSurvey = false;
                existingSurvey = null;
                
                document.getElementById('alreadySubmitted').classList.add('hidden');
                document.getElementById('surveyFormContainer').classList.remove('hidden');
                
                initializeSurveyForm();
            }
        } catch (error) {
            console.error('Error loading survey status:', error);
            document.getElementById('surveyLoading').classList.add('hidden');
            showNotification('Failed to load survey status', 'error');
        }
    }

    function initializeSurveyForm() {
        const form = document.getElementById('surveyForm');
        form.reset();
        updateStarRating(5);
        form.addEventListener('submit', handleSurveySubmit);
    }

    function updateStarRating(value) {
        const ratingValue = parseInt(value);
        document.getElementById('ratingValue').textContent = ratingValue;
        
        for (let i = 1; i <= 10; i++) {
            const star = document.querySelector(`.star-${i}`);
            if (star) {
                if (i <= ratingValue) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            }
        }
    }

    function updateRatingValue(value) {
        document.getElementById('ratingValue').textContent = value;
        updateStarRating(value);
    }

    async function handleSurveySubmit(event) {
        event.preventDefault();
        
        if (!currentUser) {
            showNotification('Please login to submit the survey', 'error');
            return;
        }
        
        if (userHasSubmittedSurvey) {
            showNotification('You have already submitted a survey', 'error');
            return;
        }
        
        const form = event.target;
        const formData = new FormData(form);
        const submitBtn = document.getElementById('submitSurveyBtn');
        
        // Validate required fields
        const requiredFields = [
            'learnedAnything',
            'resultsObserved',
            'continueNextYear',
            'challengesFaced',
            'improvementsSuggested',
            'helpNeeded',
            'exercisesHelpfulness',
            'experienceRating'
        ];
        
        let isValid = true;
        requiredFields.forEach(field => {
            if (!formData.get(field)) {
                isValid = false;
            }
        });
        
        if (!isValid) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }
        
        const surveyData = {
            studentEmail: currentUser.email,
            studentName: currentUser.displayName,
            learnedAnything: formData.get('learnedAnything'),
            resultsObserved: formData.get('resultsObserved'),
            continueNextYear: formData.get('continueNextYear'),
            challengesFaced: formData.get('challengesFaced'),
            improvementsSuggested: formData.get('improvementsSuggested'),
            helpNeeded: formData.get('helpNeeded'),
            exercisesHelpfulness: formData.get('exercisesHelpfulness'),
            experienceRating: parseInt(formData.get('experienceRating')),
            additionalComments: formData.get('additionalComments') || ''
        };
        
        if (surveyData.experienceRating < 1 || surveyData.experienceRating > 10) {
            showNotification('Please select a valid rating between 1 and 10', 'error');
            return;
        }
        
        try {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Submitting...';
            
            const response = await fetch('/api/surveys', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(surveyData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                userHasSubmittedSurvey = true;
                existingSurvey = result.data;
                
                showNotification('Survey submitted successfully! Thank you for your feedback.', 'success');
                
                document.getElementById('alreadySubmitted').classList.remove('hidden');
                document.getElementById('surveyFormContainer').classList.add('hidden');
                document.getElementById('submissionDate').textContent = 
                    new Date(result.data.submissionDate).toLocaleDateString();
                
                form.reset();
            } else {
                if (response.status === 409) {
                    userHasSubmittedSurvey = true;
                    showNotification('You have already submitted a survey', 'info');
                    
                    document.getElementById('alreadySubmitted').classList.remove('hidden');
                    document.getElementById('surveyFormContainer').classList.add('hidden');
                    await loadSurveyStatus();
                } else {
                    throw new Error(result.message || 'Failed to submit survey');
                }
            }
        } catch (error) {
            console.error('Error submitting survey:', error);
            showNotification('Failed to submit survey: ' + error.message, 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Submit Survey';
        }
    }

    // Utility Functions
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function showNotification(message, type = 'info') {
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => notification.remove());

        const notification = document.createElement('div');
        notification.className = `notification fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 transform transition-transform duration-300 ${
            type === 'success' ? 'bg-green-500' :
            type === 'error' ? 'bg-red-500' :
            'bg-blue-500'
        }`;
        notification.innerHTML = `
            <div class="flex items-center gap-2">
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);

        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }

    // Initialize animations when page loads
    document.addEventListener('DOMContentLoaded', function() {
        const animatedElements = document.querySelectorAll('.animate-fade-in, .animate-slide-in');
        animatedElements.forEach((el, index) => {
            el.style.animationDelay = `${index * 100}ms`;
        });

        const interactiveElements = document.querySelectorAll('input, select, textarea, button, label');
        interactiveElements.forEach(el => {
            el.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            el.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        const starRatingContainer = document.getElementById('starRating');
        if (starRatingContainer) {
            starRatingContainer.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const star = document.createElement('i');
                star.className = `fas fa-star text-gray-300 text-xl mx-0.5 star-${i}`;
                starRatingContainer.appendChild(star);
            }
        }
    });
</script>
</body>
</html>

